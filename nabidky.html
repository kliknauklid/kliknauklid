<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>Nab√≠dky √∫klidu | Klik na √∫klid</title>
<style>
body{font-family:Arial;background:#f4f6fb;margin:0;padding:30px}
h1{text-align:center}
table{width:100%;border-collapse:collapse;background:#fff}
th,td{padding:10px;border:1px solid #ddd;font-size:14px}
th{background:#1f2b6c;color:#fff}
.btn{background:#1f2b6c;color:#fff;border:none;padding:6px 12px;cursor:pointer;border-radius:4px}
.lock{opacity:0.4}
</style>
</head>

<body>

<h1>Nab√≠dky √∫klidu</h1>
<p style="text-align:center">Kontakty jsou skryt√© üîí ‚Äì odemknou se po zaplacen√≠</p>

<table id="nabidkyTable">
<thead>
<tr>
<th>Mƒõsto / lokalita</th>
<th>Dojed (km)</th>
<th>Typ √∫klidu</th>
<th>Dostupnost</th>
<th>Cena</th>
<th>Zku≈°enost</th>
<th>Pozn√°mka</th>
<th>Kontakt</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRc1EKWsR4iHnhk1PSgVAQ5u_YfM481jOzs9mxzXLvIZ0bhtz0TFRAAzw_15LJhvNSpyzb6dMA6IK0r/pub?output=csv";
const API_URL = "https://script.google.com/macros/s/AKfycbxJs061Eq-DJpWFkqYS5BMdyDG1KdhzfpP7tu8zVHXK7bAJ2GOkcvNqjZvBv355zcpVKw/exec";

fetch(CSV_URL)
.then(r => r.text())
.then(text => {
  const rows = text.split("\n").slice(1);
  let html = "";

  rows.forEach((row,i)=>{
    if(!row.trim()) return;
    const cols = row.split(",");

    html += `<tr>
      <td>${cols[0]}</td>
      <td>${cols[1]}</td>
      <td>${cols[2]}</td>
      <td>${cols[3]}</td>
      <td>${cols[4]}</td>
      <td>${cols[5]}</td>
      <td>${cols[6]}</td>
      <td><button class="btn" onclick="unlock(${i})">Odemknout kontakt</button></td>
    </tr>`;
  });

  document.querySelector("#nabidkyTable tbody").innerHTML = html;
});

function unlock(id){
  const email = prompt("Zadejte e-mail pro zasl√°n√≠ platebn√≠ch √∫daj≈Ø:");
  if(!email) return;

  fetch(API_URL,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({email:email,offer:id})
  })
  .then(r=>r.json())
  .then(d=>{
    if(d.status==="ok"){
      alert("Platebn√≠ √∫daje byly odesl√°ny na e-mail.");
    }else{
      alert("Chyba: "+d.message);
    }
  })
  .catch(()=>{
    alert("Chyba spojen√≠ se serverem");
  });
}
</script>

</body>
</html>
