<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>Nab√≠dky √∫klidu | Klik na √∫klid</title>

<style>
body { font-family: Arial, sans-serif; margin: 20px; }
h1 { text-align: center; }
table { width: 100%; border-collapse: collapse; margin-top: 20px; }
th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
th { background-color: #4a148c; color: white; }
tr:nth-child(even) { background: #f9f9f9; }
.lock { color: #888; font-style: italic; }

button {
  background:#4a148c;
  color:#fff;
  border:0;
  padding:6px 10px;
  cursor:pointer;
  border-radius:4px;
}
button:hover { background:#6a1b9a; }
</style>
</head>

<body>

<h1>Nab√≠dky √∫klidu</h1>
<p style="text-align:center;">
Kontakty jsou skryt√© üîí (po zaplacen√≠ se odemknou)
</p>

<table id="nabidkyTable">
  <thead>
    <tr>
      <th>Vlo≈æen√≠</th>
      <th>Mƒõsto / lokalita</th>
      <th>Dojezd (km)</th>
      <th>Typ √∫klidu</th>
      <th>Dostupnost</th>
      <th>Cena</th>
      <th>Zku≈°enost</th>
      <th>Pozn√°mka</th>
      <th>Kontakt</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRc1EKWsR4iHnhk1PSgVAQ5u_YfM481jOzs9mxzXLvIZ0bhtz0TFRAAzw_15LJhvNSpyzb6dMA6IK0r/pub?output=csv";

// CSV parser
function parseCSV(text) {
  const rows = [];
  let row = [], cell = "", q = false;

  for (let char of text) {
    if (char === '"') q = !q;
    else if (char === "," && !q) {
      row.push(cell); cell = "";
    } else if (char === "\n" && !q) {
      row.push(cell); rows.push(row);
      row = []; cell = "";
    } else cell += char;
  }
  if (cell) row.push(cell);
  if (row.length) rows.push(row);
  return rows;
}

fetch(sheetUrl)
  .then(res => res.text())
  .then(csv => {
    const data = parseCSV(csv);
    const rows = data.slice(1);
    let html = "";

    rows.forEach((cols, i) => {
      if (!cols.length) return;

      html += `
        <tr>
          <td>${cols[0] || ""}</td>
          <td>${cols[4] || ""}</td>
          <td>${cols[5] || ""}</td>
          <td>${cols[6] || ""}</td>
          <td>${cols[7] || ""}</td>
          <td>${cols[8] || ""}</td>
          <td>${cols[9] || ""}</td>
          <td>${cols[10] || ""}</td>
          <td>
            <button onclick="unlockOffer(${i})">
              üîì Odemknout kontakt (99 Kƒç)
            </button>
          </td>
        </tr>
      `;
    });

    document.querySelector("#nabidkyTable tbody").innerHTML = html;
  });

function unlockOffer(id) {
  const email = prompt("Zadejte e-mail pro zasl√°n√≠ platebn√≠ch √∫daj≈Ø:");
  if (!email) return;

  fetch("https://script.google.com/macros/s/AKfycbx8mHex_VyG5ne3iEJwp3qrYQsWprLtZIgzhw1uMopKHdyVkIXMAEI11v4vLid-Iw58uQ/exec", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      email: email,
      offer: id,
      type: "nabidka"
    })
  })
  .then(res => res.text())
  .then(text => {
    console.log("Odpovƒõƒè scriptu:", text);
    alert("Server odpovƒõdƒõl: " + text);
  })
  .catch(err => {
    console.error(err);
    alert("Chyba p≈ôi odes√≠l√°n√≠ mailu");
  });
}
</script>

</body>
</html>
