<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>NabÃ­dky Ãºklidu | Klik na Ãºklid</title>

<style>
body { font-family: Arial, sans-serif; margin: 20px; }
h1 { text-align: center; }
table { width: 100%; border-collapse: collapse; margin-top: 20px; }
th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
th { background-color: #4a148c; color: white; }
tr:nth-child(even) { background: #f9f9f9; }
.lock { color: #888; font-style: italic; }

button {
  background:#4a148c;
  color:#fff;
  border:0;
  padding:6px 10px;
  cursor:pointer;
  border-radius:4px;
}
button:hover { background:#6a1b9a; }
</style>
</head>

<body>

<h1>NabÃ­dky Ãºklidu</h1>
<p style="text-align:center;">
Kontakty jsou skrytÃ© ğŸ”’ (po zaplacenÃ­ se odemknou)
</p>

<table id="nabidkyTable">
  <thead>
    <tr>
      <th>VloÅ¾enÃ­</th>
      <th>MÄ›sto / lokalita</th>
      <th>Dojezd (km)</th>
      <th>Typ Ãºklidu</th>
      <th>Dostupnost</th>
      <th>Cena</th>
      <th>ZkuÅ¡enost</th>
      <th>PoznÃ¡mka</th>
      <th>Kontakt</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRc1EKWsR4iHnhk1PSgVAQ5u_YfM481jOzs9mxzXLvIZ0bhtz0TFRAAzw_15LJhvNSpyzb6dMA6IK0r/pub?output=csv";

// CSV parser
function parseCSV(text) {
  const rows = [];
  let row = [], cell = "", q = false;

  for (let char of text) {
    if (char === '"') q = !q;
    else if (char === "," && !q) {
      row.push(cell); cell = "";
    } else if (char === "\n" && !q) {
      row.push(cell); rows.push(row);
      row = []; cell = "";
    } else cell += char;
  }
  if (cell) row.push(cell);
  if (row.length) rows.push(row);
  return rows;
}

fetch(sheetUrl)
  .then(res => res.text())
  .then(csv => {
    const data = parseCSV(csv);
    const rows = data.slice(1);
    let html = "";

    rows.forEach((cols, i) => {
      if (!cols.length) return;

      html += `
        <tr>
          <td>${cols[0] || ""}</td>
          <td>${cols[4] || ""}</td>
          <td>${cols[5] || ""}</td>
          <td>${cols[6] || ""}</td>
          <td>${cols[7] || ""}</td>
          <td>${cols[8] || ""}</td>
          <td>${cols[9] || ""}</td>
          <td>${cols[10] || ""}</td>
          <td>
            <button onclick="unlockOffer(${i})">
              ğŸ”“ Odemknout kontakt (99 KÄ)
            </button>
          </td>
        </tr>
      `;
    });

    document.querySelector("#nabidkyTable tbody").innerHTML = html;
  });

function unlockOffer(id) {
  const email = prompt("Zadejte e-mail pro zaslÃ¡nÃ­ platebnÃ­ch ÃºdajÅ¯:");
  if (!email) return;

  const url = "https://script.google.com/macros/s/AKfycbydj7EbFDkDI7uhJrDXei1mLLhumXimmfPVheib71y36IXQyhGr7I5aurIUL2fZDPx/exec";

  const data = new URLSearchParams();
  data.append("email", email);
  data.append("offer", id);
  data.append("type", "nabidka");

  fetch(url, {
    method: "POST",
    body: data
  })
  .then(res => res.text())
  .then(txt => {
    alert("Pokyny k platbÄ› byly odeslÃ¡ny na e-mail âœ…");
    console.log("Server:", txt);
  })
  .catch(err => {
    alert("Chyba pÅ™i odesÃ­lÃ¡nÃ­ âŒ");
    console.error(err);
  });
}
[12:14, 9. 2. 2026] KateÅ™ina S.: function doPost(e) {
  const email = e.parameter.email;
  const offer = e.parameter.offer;
  const type = e.parameter.type;

  MailApp.sendEmail({
    to: email,
    subject: "Platba za odemknutÃ­ kontaktu â€“ Klik na Ãºklid",
    body: `
DobrÃ½ den,

pro odemknutÃ­ kontaktu k nabÃ­dce Ä. ${offer} proveÄte platbu:

ÄŒÃ¡stka: 99 KÄ
ÃšÄet: XXXXXXXX/XXXX
VS: ${Date.now()}

Po pÅ™ijetÃ­ platby bude kontakt automaticky zpÅ™Ã­stupnÄ›n.

Klik na Ãºklid
`
  });

  return ContentService
    .createTextOutput("OK")
    .setMimeType(ContentService.MimeType.TEXT);
}
