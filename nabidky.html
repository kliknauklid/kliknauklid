<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>NabÃ­dky Ãºklidu | Klik na Ãºklid</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f5f5f7;
  margin: 20px;
}
h1 {
  text-align: center;
}
table {
  border-collapse: collapse;
  width: 100%;
  margin-top: 20px;
}
th, td {
  border: 1px solid #ddd;
  padding: 8px;
  font-size: 14px;
}
th {
  background: #243a8f;
  color: white;
}
button.unlock-btn {
  background: #007bff;
  color: white;
  border: none;
  padding: 6px 10px;
  cursor: pointer;
  border-radius: 4px;
}
button.unlock-btn:hover {
  background: #0056b3;
}
.lock {
  color: #888;
  font-style: italic;
}
</style>
</head>

<body>
<h1>NabÃ­dky Ãºklidu</h1>
<p style="text-align:center;">Kontakty jsou skrytÃ© ðŸ”’ â€“ odemknou se po zaplacenÃ­</p>

<table id="offersTable">
  <thead>
    <tr>
      <th>MÄ›sto / lokalita</th>
      <th>Dojezd (km)</th>
      <th>Typ Ãºklidu</th>
      <th>Dostupnost</th>
      <th>Cena</th>
      <th>ZkuÅ¡enost</th>
      <th>PoznÃ¡mka</th>
      <th>Kontakt</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
// === URL tvÃ©ho Apps Script API (GET i POST) ===
const API_URL = "https://script.google.com/macros/s/AKfycbwE0EZp1L-DNUa4h47cDPgS9DDbpGwPFfKdrgPoCKcrXRA80g6xNWFeA1liEj6A7UQw-g/exec";

// 1) NAÄŒTEME DATA (GET â†’ JSON)
fetch(API_URL)
  .then(res => res.json())
  .then(data => {
    const tbody = document.querySelector("#offersTable tbody");
    let html = "";

    data.forEach((item, index) => {
      html += `
        <tr>
          <td>${item.mesto || ""}</td>
          <td>${item.dojezd || ""}</td>
          <td>${item.typUklidu || ""}</td>
          <td>${item.dostupnost || ""}</td>
          <td>${item.cena || ""}</td>
          <td>${item.zkusenost || ""}</td>
          <td>${item.poznamka || ""}</td>
          <td>
            <button class="unlock-btn" onclick="unlockContact(${index})">
              ðŸ”“ Odemknout kontakt
            </button>
          </td>
        </tr>
      `;
    });

    tbody.innerHTML = html;
  })
  .catch(err => {
    console.error("Chyba naÄÃ­tÃ¡nÃ­ dat:", err);
  });

// 2) FUNKCE PRO ODEMÄŒENÃ
function unlockContact(offerId) {
  const email = prompt("Zadejte e-mail, kam vÃ¡m majÃ­ pÅ™ijÃ­t platebnÃ­ Ãºdaje:");
  if (!email) return;

  // pÅ™ipravÃ­me POST tÄ›lo
  const body = {
    email: email,
    type: "nabidka",
    offerId: offerId
  };

  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify(body),
    headers: {
      "Content-Type": "application/json"
    }
  })
  .then(res => res.json())
  .then(result => {
    alert("Pokyny k platbÄ› byly odeslÃ¡ny na e-mail ðŸ“©");
  })
  .catch(err => {
    console.error("Chyba pÅ™i odesÃ­lÃ¡nÃ­:", err);
    alert("NÄ›co se nepovedlo ðŸ˜•");
  });
}
</script>

</body>
</html>
