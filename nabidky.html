<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>NabÃ­dky Ãºklidu | Klik na Ãºklid</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f5f7fb;
  margin: 0;
  padding: 30px;
}

h1 {
  text-align: center;
}

.subtitle {
  text-align: center;
  color: #666;
  margin-bottom: 30px;
}

table {
  width: 100%;
  border-collapse: collapse;
  background: white;
}

th, td {
  padding: 10px;
  border: 1px solid #ddd;
  font-size: 14px;
  text-align: left;
}

th {
  background: #243a8f;
  color: white;
}

.unlock-btn {
  background: #243a8f;
  color: white;
  border: none;
  padding: 6px 10px;
  cursor: pointer;
  border-radius: 5px;
}

.unlock-btn:hover {
  background: #1a2b6d;
}

.lock {
  color: #999;
  font-style: italic;
}
</style>
</head>

<body>

<h1>NabÃ­dky Ãºklidu</h1>
<div class="subtitle">Kontakty jsou skrytÃ© ğŸ”’ (po zaplacenÃ­ se odemknou)</div>

<table id="nabidkyTable">
  <thead>
    <tr>
      <th>VloÅ¾enÃ­</th>
      <th>MÄ›sto / lokalita</th>
      <th>Dojezd (km)</th>
      <th>Typ Ãºklidu</th>
      <th>Dostupnost</th>
      <th>Cena</th>
      <th>ZkuÅ¡enost</th>
      <th>PoznÃ¡mka</th>
      <th>Kontakt</th>
    </tr>
  </thead>
  <tbody>
    <!-- data se naÄtou dynamicky -->
  </tbody>
</table>

<script>
const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRc1EKWsR4iHnhk1PSgVAQ5u_YfM481jOzs9mxzXLvIZ0bhtz0TFRAAzw_15LJhvNSpyzb6dMA6IK0r/pub?output=csv";

/* NAÄŒTENÃ TABULKY */
fetch(SHEET_URL)
  .then(res => res.text())
  .then(html => {
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, "text/html");
    const rows = doc.querySelectorAll("table tr");

    let htmlRows = "";
    let id = 1;

    rows.forEach((row, index) => {
      if(index === 0) return; // pÅ™eskoÄÃ­ hlaviÄku

      const cols = row.querySelectorAll("td");
      if(cols.length < 8) return;

      htmlRows += `
        <tr>
          <td>${cols[0].innerText}</td>
          <td>${cols[4].innerText}</td>
          <td>${cols[5].innerText}</td>
          <td>${cols[6].innerText}</td>
          <td>${cols[7].innerText}</td>
          <td>${cols[8].innerText}</td>
          <td>${cols[9].innerText}</td>
          <td>${cols[10].innerText}</td>
          <td>
            <button class="unlock-btn" onclick="unlockOffer(${id})">
              ğŸ”“ Odemknout kontakt (99 KÄ)
            </button>
          </td>
        </tr>
      `;
      id++;
    });

    document.querySelector("#nabidkyTable tbody").innerHTML = htmlRows;
  });

/* ODEMKNUTÃ NABÃDKY */
function unlockOffer(id) {
  const email = prompt("Zadejte e-mail pro zaslÃ¡nÃ­ platebnÃ­ch ÃºdajÅ¯:");
  if (!email) return;

  const url = "https://script.google.com/macros/s/AKfycbx0sh8gr575WpbdcREz5h7MtHrwV10XFUpsWPluvWGYDD-asd-jD9cBFZVXzNTzMq9c/exec";

  const data = new URLSearchParams();
  data.append("email", email);
  data.append("offer", id);
  data.append("type", "nabidka");

  fetch(url, {
    method: "POST",
    body: data
  })
  .then(res => res.text())
  .then(txt => {
    alert("Pokyny k platbÄ› byly odeslÃ¡ny na e-mail âœ…");
    console.log("Server:", txt);
  })
  .catch(err => {
    alert("Chyba pÅ™i odesÃ­lÃ¡nÃ­ âŒ");
    console.error(err);
  });
}
</script>

</body>
</html>
