const API_URL = "SEM_VLOZ_URL_WEB_APP";

let selectedOfferId = null;

// načtení veřejné nabídky
fetch(API_URL + "?action=getPublicOffers")
  .then(res => res.json())
  .then(data => {
    const tbody = document.getElementById("offers");
    data.forEach(o => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${o.jmeno}</td>
        <td>${o.mesto}</td>
        <td><button onclick="openPopup('${o.id}')">Zobrazit kontakt</button></td>
      `;
      tbody.appendChild(tr);
    });
  });

// otevření popupu
function openPopup(offerId) {
  selectedOfferId = offerId;
  document.getElementById("popup").style.display = "block";
}

// zavření popupu
function closePopup() {
  document.getElementById("popup").style.display = "none";
}

// odeslání emailu
function sendEmail() {
  const email = document.getElementById("email").value;

  if (!email) {
    alert("Zadejte email");
    return;
  }

  fetch(
    API_URL +
    "?action=sendPaymentMail" +
    "&email=" + encodeURIComponent(email) +
    "&offerId=" + encodeURIComponent(selectedOfferId)
  )
  .then(res => res.json())
  .then(() => {
    alert("Email s pokyny k platbě byl odeslán.");
    closePopup();
  });
}
