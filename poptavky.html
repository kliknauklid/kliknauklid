<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>Popt√°vky √∫klidu | Klik na √∫klid</title>

<style>
body { font-family: Arial, sans-serif; margin: 20px; }
h1 { text-align: center; }
table { width: 100%; border-collapse: collapse; margin-top: 20px; }
th, td { border: 1px solid #ddd; padding: 8px; }
th { background-color: #4a148c; color: white; }
tr:nth-child(even) { background: #f9f9f9; }
button { background:#4a148c; color:#fff; border:0; padding:6px 10px; cursor:pointer; }
button:hover { background:#6a1b9a; }
</style>
</head>

<body>

<h1>Popt√°vky √∫klidu</h1>
<p style="text-align:center;">Kontakty jsou skryt√© üîí (po zaplacen√≠ se odemknou)</p>

<table id="poptavkyTable">
<thead>
<tr>
<th>Vlo≈æen√≠</th>
<th>Mƒõsto</th>
<th>Typ √∫klidu</th>
<th>Velikost prostoru</th>
<th>Po≈æadovan√Ω term√≠n</th>
<th>Po≈æadovan√Ω ƒças</th>
<th>Frekvence</th>
<th>√öklidov√© prost≈ôedky</th>
<th>Pozn√°mka</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT8lnbTzm5n8aSNQ2vi7JmCBzfaxsuirnIvqtHPLnsOivE_wSwCDUWzMGICPAc3uVr7Wfe884fPvivM/pub?output=csv";

// jednoduch√Ω CSV parser
function parseCSV(text){
  const rows = [];
  let row = [], cell = "", q = false;
  for (let i=0;i<text.length;i++){
    const c = text[i];
    if (c === '"' ) q = !q;
    else if (c === ',' && !q){ row.push(cell); cell=""; }
    else if ((c === "\n" || c === "\r") && !q){
      if(cell || row.length){ row.push(cell); rows.push(row); }
      row=[]; cell="";
    } else cell+=c;
  }
  if(cell || row.length){ row.push(cell); rows.push(row); }
  return rows;
}

fetch(CSV_URL)
.then(r => r.text())
.then(csv => {
  const data = parseCSV(csv);
  const rows = data.slice(1); // bez hlaviƒçky
  let html = "";

  rows.forEach((c,i) => {
    if(!c.length) return;

    html += `
    <tr>
      <td>${c[0] || ""}</td>
      <td>${c[4] || ""}</td>
      <td>${c[5] || ""}</td>
      <td>${c[7] || ""}</td>
      <td>${c[10] || ""}</td>
      <td>${c[11] || ""}</td>
      <td>${c[6] || ""}</td>
      <td>${c[9] || ""}</td>
      <td>${c[12] || ""}</td>
      <td><button onclick="unlock(${i})">üîì Odemknout (99 Kƒç)</button></td>
    </tr>`;
  });

  document.querySelector("#poptavkyTable tbody").innerHTML = html;
});

function unlock(id){
  const email = prompt("Zadejte e-mail pro zasl√°n√≠ platebn√≠ch √∫daj≈Ø:");
  if(!email) return;

  fetch("api/request.php",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ email:email, offer:id })
  });

  alert("Na e-mail byly odesl√°ny pokyny k platbƒõ.");
}
</script>

</body>
</html>
